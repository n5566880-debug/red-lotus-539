import streamlit as st
import datetime

# --- è¨­å®šé é¢è³‡è¨Š ---
st.set_page_config(page_title="ç´…è“®æˆ°ç•¥ç³»çµ±", page_icon="ğŸ”¥", layout="wide")

# --- æ ¸å¿ƒå‡½æ•¸ï¼šä¸éœ€å¤–æ›çš„äººå¿ƒç®—æ³• ---
def get_constellation(month, day):
    dates = (20, 19, 21, 20, 21, 21, 23, 23, 23, 24, 22, 22)
    constellations = ("æ‘©ç¾¯åº§", "æ°´ç“¶åº§", "é›™é­šåº§", "ç‰¡ç¾Šåº§", "é‡‘ç‰›åº§", "é›™å­åº§", 
                      "å·¨èŸ¹åº§", "ç…å­åº§", "è™•å¥³åº§", "å¤©ç§¤åº§", "å¤©è åº§", "å°„æ‰‹åº§", "æ‘©ç¾¯åº§")
    if day < dates[month-1]:
        return constellations[month-1]
    else:
        return constellations[month]

def get_life_number(d):
    # ç”Ÿå‘½éˆæ•¸è¨ˆç®— (å¹´æœˆæ—¥åŠ ç¸½)
    s = str(d.year) + str(d.month) + str(d.day)
    num = sum(int(c) for c in s)
    while num > 9:
        num = sum(int(c) for c in str(num))
    return num

def get_human_analysis(birth_date):
    constellation = get_constellation(birth_date.month, birth_date.day)
    life_num = get_life_number(birth_date)
    
    # ç´…è“®çš„åˆ†æè³‡æ–™åº«
    analysis_db = {
        1: "ã€é–‹å‰µè€…ã€‘ç¨ç«‹ã€æœ‰é ˜å°åŠ›ï¼Œä½†ä¹Ÿå®¹æ˜“ç¨æ–·ã€‚é©åˆç•¶å¸¶é ­å¤§å“¥ã€‚",
        2: "ã€å”èª¿è€…ã€‘æ•æ„Ÿã€é‡ç´°ç¯€ï¼Œä¹Ÿæ˜¯å¾ˆå¥½çš„é…åˆè€…ã€‚é©åˆåšå‰¯æ‰‹æˆ–å¹•åƒšã€‚",
        3: "ã€å‰µæ„å®¶ã€‘æ¨‚è§€ã€é»å­å¤šï¼Œåƒæ˜¯é•·ä¸å¤§çš„å­©å­ã€‚é©åˆéœ€è¦éˆæ„Ÿçš„è·ä½ã€‚",
        4: "ã€åŸ·è¡Œè€…ã€‘ç©©å®šã€æŒ‰éƒ¨å°±ç­ï¼Œéå¸¸æœ‰å®‰å…¨æ„Ÿã€‚é©åˆç®¡éŒ¢æˆ–å®ˆæˆã€‚",
        5: "ã€å†’éšªå®¶ã€‘æ„›è‡ªç”±ã€å£æ‰å¥½ï¼Œè¨å­è¢«ç´„æŸã€‚é©åˆæ¥­å‹™æˆ–å…¬é—œã€‚",
        6: "ã€é—œæ‡·è€…ã€‘é‡æ„Ÿæƒ…ã€è² è²¬ä»»ï¼Œå¾ˆæœƒç…§é¡§äººã€‚é©åˆäººäº‹æˆ–æœå‹™ã€‚",
        7: "ã€åˆ†æå¸«ã€‘å–œæ­¡é‘½ç ”ã€ç›´è¦ºå¼·ï¼Œåƒä½ ä¸€æ¨£å¸¶æœ‰ç¥ç§˜æ„Ÿã€‚é©åˆç­–åŠƒã€‚",
        8: "ã€æ¬ŠåŠ›è€…ã€‘çœ‹é‡ååˆ©ã€æœ‰å•†æ¥­é ­è…¦ï¼Œå¤©ç”Ÿçš„è€é—†æ ¼ã€‚é©åˆæ“ç›¤ã€‚",
        9: "ã€å¤¢æƒ³å®¶ã€‘å¤§æ„›ã€ç„¡ç§ï¼Œä½†ä¹Ÿå®¹æ˜“ä¸åˆ‡å¯¦éš›ã€‚é©åˆå…¬ç›Šæˆ–è—è¡“ã€‚"
    }
    
    return constellation, life_num, analysis_db.get(life_num, "ç¥ç§˜çš„éˆé­‚")

# --- ä»‹é¢è¨­è¨ˆ ---

# å´é‚Šæ¬„
st.sidebar.title("ğŸ›¡ï¸ ç´…è“®æˆ°ç•¥æŒ‡æ®éƒ¨")
st.sidebar.info("å‰¯å®˜ç´…è“®å¾…å‘½ä¸­...")
menu = st.sidebar.radio("é¸æ“‡åŠŸèƒ½æ¨¡çµ„", ["ğŸ² è³­ç‹æ±ºç­–ç³»çµ± (æ ¸å¿ƒ)", "ğŸ‘¤ äººå¿ƒåˆ¤æ–·ç³»çµ± (æ–°)", "ğŸ¢ éˆé¾œå¤§å‰æ¸…å–®"])

# === åŠŸèƒ½ 1: è³­ç‹æ±ºç­–ç³»çµ± ===
if menu == "ğŸ² è³­ç‹æ±ºç­–ç³»çµ± (æ ¸å¿ƒ)":
    st.title("ğŸ° å°ˆæ¥­è³‡é‡‘æ§ç®¡ãƒ»æˆ°è¡“çµ‚ç«¯")
    st.markdown("---")
    
    col1, col2 = st.columns(2)
    with col1:
        numbers = st.text_input("è¼¸å…¥æœ¬æœŸé–å®šè™Ÿç¢¼ (ä¾‹å¦‚: 24, 25, 34)", "07, 11, 24, 25, 34")
    with col2:
        budget = st.number_input("ç¸½æˆ°å‚™è³‡é‡‘ ($)", min_value=0, value=2000, step=100)

    # æ¨¡æ“¬è¨ˆç®—é‚è¼¯
    st.markdown("### ğŸ“Š æ±ºç­–å„€è¡¨æ¿")
    
    # é€™è£¡ä¿ç•™ä½ åŸæœ¬å–œæ­¡çš„ 1.59% é¢¨æ ¼
    suggested_ratio = 1.59
    if "34" in numbers:
        suggested_ratio += 3.2  # å¦‚æœæœ‰34è™Ÿï¼Œä¿¡å¿ƒå¤§å¢
        st.caption("ğŸ”¥ åµæ¸¬åˆ°æ ¸å¿ƒè™Ÿç¢¼ 34ï¼Œæ¬Šé‡å·²è‡ªå‹•åŠ æˆï¼")
    
    st.success(f"å»ºè­°ä¸‹æ³¨æ¯”ä¾‹ï¼š **{suggested_ratio:.2f}%**")
    
    bet_amount = budget * (suggested_ratio / 100)
    st.info(f"å»ºè­°å–®æ³¨é‡‘é¡ï¼š **${bet_amount:.0f}** (ç´„ {int(bet_amount/50)} æ³¨ 539)")
    
    st.warning("âš ï¸ è­¦å‘Šï¼šé¢¨éšªéé«˜ï¼Œå»ºè­°ç¶²æŠ•æˆ–åƒ…ä¸‹ 1 æ³¨ã€‚")

# === åŠŸèƒ½ 2: äººå¿ƒåˆ¤æ–·ç³»çµ± ===
elif menu == "ğŸ‘¤ äººå¿ƒåˆ¤æ–·ç³»çµ± (æ–°)":
    st.title("ğŸ‘ï¸ äººå¿ƒåˆ¤æ–·ãƒ»è­˜äººè¡“")
    st.markdown("è¼¸å…¥ç”Ÿæ—¥ï¼Œçœ‹ç©¿å°æ–¹çš„åº•å±¤é‚è¼¯èˆ‡ä½¿ç”¨èªªæ˜æ›¸ã€‚")
    st.markdown("---")

    c1, c2 = st.columns(2)
    with c1:
        target_name = st.text_input("å°è±¡ä»£è™Ÿ", "ç¥ç§˜äºº")
        b_date = st.date_input("å‡ºç”Ÿå¹´æœˆæ—¥", datetime.date(1996, 2, 17))
    with c2:
        mode = st.radio("å•Ÿå‹•æ¨¡å¼", ["äº¤å‹/çœ‹é€äººå¿ƒ", "é¢è©¦/è­˜äººç”¨äºº"])

    if st.button("ğŸ”¥ å•Ÿå‹•ç´…è“®è§£æ"):
        constellation, life_num, trait = get_human_analysis(b_date)
        
        st.divider()
        st.subheader(f"ğŸ¯ ç›®æ¨™åˆ†æï¼š{target_name}")
        
        m1, m2, m3 = st.columns(3)
        m1.metric("æ˜Ÿåº§", constellation)
        m2.metric("ç”Ÿå‘½éˆæ•¸", f"{life_num} è™Ÿäºº")
        m3.metric("æ ¸å¿ƒé—œéµå­—", trait.split("ã€‘")[0].replace("ã€", ""))
        
        st.markdown("### ğŸ“ ç´…è“®å‰¯å®˜å ±å‘Š")
        st.write(f"**ã€æ€§æ ¼ç‰¹è³ªã€‘**\n{trait}")
        
        st.markdown("### ğŸ›¡ï¸ æˆ°ç•¥å»ºè­°")
        if mode == "äº¤å‹/çœ‹é€äººå¿ƒ":
            st.info(f"é¢å°**{constellation}**çš„{life_num}è™Ÿäººï¼Œè«‹ä¿æŒçœŸèª ã€‚ä»–å€‘é€šå¸¸åƒè»Ÿä¸åƒç¡¬ã€‚è‹¥è¦è´å¾—ä¿¡ä»»ï¼Œè«‹å±•ç¾ä½ çš„å°ˆæ¥­èˆ‡ä¸»è¦‹ã€‚")
        else:
            st.success(f"æ­¤äººé©åˆæ“”ä»»**{trait.split('é©åˆ')[1]}**ã€‚è‹¥ç”¨æ–¼åœ˜éšŠï¼Œè«‹æ³¨æ„ä»–çš„æƒ…ç·’ç©©å®šåº¦ã€‚")

# === åŠŸèƒ½ 3: éˆé¾œæ¸…å–® ===
elif menu == "ğŸ¢ éˆé¾œå¤§å‰æ¸…å–®":
    st.title("ğŸ¢ éˆé¾œå¤§å‰ãƒ»å”¯ä¸€èªè­‰")
    st.balloons()
    st.success("### ğŸ”¥ æœ¬æœŸå”¯ä¸€ 5 é¡†å¤§å‰")
    st.markdown("""
    # **07ã€11ã€24ã€25ã€34**
    
    * **æ ¸å¿ƒä¸»æ˜Ÿï¼š** 34 (ç´…è‰²å›å½ˆ)
    * **æˆ°ç•¥è©•åƒ¹ï¼š** å”¯ä¸€å¤§å‰ï¼Œå»ºè­°é–å®šã€‚
    """)
