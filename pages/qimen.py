import streamlit as st
import datetime
import random

# --- é é¢åŸºç¤è¨­å®š ---
st.set_page_config(page_title="ç´…è“®æˆ°ç•¥ç³»çµ±", page_icon="ğŸ”¥", layout="wide")

# --- æ ¸å¿ƒé‚è¼¯å‡½æ•¸ (ä¸éœ€å¤–æ›ï¼Œä¿è­‰ä¸å ±éŒ¯) ---
def get_constellation(month, day):
    dates = (20, 19, 21, 20, 21, 21, 23, 23, 23, 24, 22, 22)
    constellations = ("æ‘©ç¾¯åº§", "æ°´ç“¶åº§", "é›™é­šåº§", "ç‰¡ç¾Šåº§", "é‡‘ç‰›åº§", "é›™å­åº§", 
                      "å·¨èŸ¹åº§", "ç…å­åº§", "è™•å¥³åº§", "å¤©ç§¤åº§", "å¤©è åº§", "å°„æ‰‹åº§", "æ‘©ç¾¯åº§")
    if day < dates[month-1]:
        return constellations[month-1]
    else:
        return constellations[month]

def get_life_number(d):
    # ç”Ÿå‘½éˆæ•¸è¨ˆç®—
    s = str(d.year) + str(d.month) + str(d.day)
    num = sum(int(c) for c in s)
    while num > 9:
        num = sum(int(c) for c in str(num))
    return num

def get_human_analysis(birth_date):
    # ç´…è“®çš„äººå¿ƒåˆ¤æ–·è³‡æ–™åº«
    constellation = get_constellation(birth_date.month, birth_date.day)
    life_num = get_life_number(birth_date)
    
    analysis_db = {
        1: "ã€é–‹å‰µè€…ã€‘ç¨ç«‹ã€å¼·å‹¢ã€æœ‰é ˜è¢–æ°£è³ªã€‚åƒè»Ÿä¸åƒç¡¬ï¼Œéœ€è¦èˆå°ã€‚",
        2: "ã€å”èª¿è€…ã€‘ç´°è†©ã€æ•æ„Ÿã€ä¾è³´é—œä¿‚ã€‚éœ€è¦è¢«é™ªä¼´èˆ‡å‚¾è½ã€‚",
        3: "ã€å‰µæ„å®¶ã€‘åƒå­©å­ä¸€æ¨£å¤šè®Šã€æ¨‚è§€ã€‚è¨å­ç„¡èŠï¼Œå–œæ­¡æ–°é®®æ„Ÿã€‚",
        4: "ã€åŸ·è¡Œè€…ã€‘è¿½æ±‚å®‰å…¨æ„Ÿã€å›ºåŸ·ã€æœ‰æ¢ç†ã€‚ä¸è¦éš¨ä¾¿è®Šå‹•ä»–çš„è¨ˆç•«ã€‚",
        5: "ã€å†’éšªå®¶ã€‘è‡ªç”±å¥”æ”¾ã€å£æ‰å¥½ã€‚æœ€è¨å­è¢«ç®¡æŸèˆ‡ç¢ç¢å¿µã€‚",
        6: "ã€é—œæ‡·è€…ã€‘è²¬ä»»å¿ƒé‡ã€æ„›ç…§é¡§äººã€‚å®¹æ˜“æŠŠåˆ¥äººçš„äº‹æ”¬åœ¨èº«ä¸Šã€‚",
        7: "ã€åˆ†æå¸«ã€‘ç›´è¦ºå¼·ã€å¸¶é»ç¥ç§˜æ„Ÿã€å–œæ­¡ç¨è™•ã€‚è¨å­ç¬¨è›‹ã€‚",
        8: "ã€æ¬ŠåŠ›è€…ã€‘çœ‹é‡å¯¦éš›åˆ©ç›Šã€éœ¸æ°£ã€‚é©åˆè«‡ç”Ÿæ„ï¼Œä¸é©åˆè«‡å¿ƒã€‚",
        9: "ã€å¤¢æƒ³å®¶ã€‘å¤§æ„›ã€ç„¡ç§ã€æœ‰æ™‚ä¸åˆ‡å¯¦éš›ã€‚éœ€è¦è¢«ç²¾ç¥ä¸Šçš„æ”¯æŒã€‚"
    }
    return constellation, life_num, analysis_db.get(life_num, "ç¥ç§˜çš„éˆé­‚")

# --- å´é‚Šæ¬„å°èˆª (é‚„åŸä½ çš„åŸå§‹è¨­å®š) ---
st.sidebar.title("ğŸ›¡ï¸ ç´…è“®æˆ°ç•¥æŒ‡æ®éƒ¨")
st.sidebar.caption("å‰¯å®˜ç´…è“® / ç³»çµ±é‹ä½œä¸­...")

# é€™è£¡åŒ…å«äº†ä½ æˆªåœ–è£¡æ‰€æœ‰çš„åŠŸèƒ½ï¼ŒåŠ ä¸Šæ–°çš„
menu = st.sidebar.radio("æˆ°ç•¥åŠŸèƒ½æ¨¡çµ„", [
    "ğŸ² è³­ç‹æ±ºç­–ç³»çµ± (æ ¸å¿ƒ)", 
    "ğŸ“ˆ è²¡å‹™æˆ°ç¸¾è¦†ç›¤", 
    "ğŸ‘§ äºˆå©•æƒ…ç·’é›·é”", 
    "ğŸ”¢ è™Ÿç¢¼æŠ€è¡“åˆ†æ", 
    "â³ ä»Šæ—¥æ™‚ç©ºæˆ°ç•¥", 
    "ğŸ‘¤ æ·±å±¤æœ¬å‘½è§£æ (äººå¿ƒåˆ¤æ–·)", 
    "â¤ï¸ æƒ…å ´æˆ°ç•¥æŒ‡æ®éƒ¨",
    "ğŸ¢ éˆé¾œå¤§å‰æ¸…å–® (æœ¬æœŸé‡é»)"
])

# ==================================================
# 1. ğŸ² è³­ç‹æ±ºç­–ç³»çµ± (æ ¸å¿ƒ)
# ==================================================
if menu == "ğŸ² è³­ç‹æ±ºç­–ç³»çµ± (æ ¸å¿ƒ)":
    st.title("ğŸ° å°ˆæ¥­è³‡é‡‘æ§ç®¡ãƒ»æˆ°è¡“çµ‚ç«¯")
    st.markdown("---")
    
    col1, col2 = st.columns(2)
    with col1:
        numbers = st.text_input("è¼¸å…¥æœ¬æœŸé–å®šè™Ÿç¢¼", "07, 11, 24, 25, 34")
    with col2:
        budget = st.number_input("ç¸½æˆ°å‚™è³‡é‡‘ ($)", min_value=0, value=2000, step=100)

    st.markdown("### ğŸ“Š æ±ºç­–å„€è¡¨æ¿")
    suggested_ratio = 1.59
    if "34" in numbers:
        suggested_ratio += 3.2
        st.caption("ğŸ”¥ åµæ¸¬åˆ°æ ¸å¿ƒä»£ç¢¼ [34]ï¼Œä¿¡å¿ƒæŒ‡æ•¸åŠ æˆï¼")
    
    st.success(f"å»ºè­°ä¸‹æ³¨æ¯”ä¾‹ï¼š **{suggested_ratio:.2f}%**")
    bet_amount = budget * (suggested_ratio / 100)
    st.info(f"å»ºè­°å–®æ³¨é‡‘é¡ï¼š **${bet_amount:.0f}**")
    st.warning("âš ï¸ è­¦å‘Šï¼šé¢¨éšªéé«˜ï¼Œå»ºè­°ç¶²æŠ•æˆ–åƒ…ä¸‹ 1 æ³¨ã€‚")

# ==================================================
# 2. ğŸ“ˆ è²¡å‹™æˆ°ç¸¾è¦†ç›¤
# ==================================================
elif menu == "ğŸ“ˆ è²¡å‹™æˆ°ç¸¾è¦†ç›¤":
    st.title("ğŸ“ˆ è²¡å‹™æˆ°ç¸¾è¦†ç›¤")
    st.info("ç´€éŒ„æ¯ä¸€å ´æˆ°å½¹çš„å¾—å¤±ï¼Œä¿®æ­£ä¸‹ä¸€æ¬¡çš„å½ˆé“ã€‚")
    
    c1, c2, c3 = st.columns(3)
    c1.metric("æœ¬æœˆæ·¨åˆ©", "+$12,500", "5.2%")
    c2.metric("å‹ç‡", "38.5%", "-2.1%")
    c3.metric("æœ€å¤§å›æ’¤", "-$3,200", "æ§åˆ¶å…§")
    
    st.text_area("æˆ°é¬¥ç­†è¨˜/æª¢è¨", "34è™Ÿå›å½ˆå¦‚é æœŸï¼Œä½†é€£ç¢°æ²’è£œåˆ°...")

# ==================================================
# 3. ğŸ‘§ äºˆå©•æƒ…ç·’é›·é” (ä½ è¦çš„åŸæœ¬åŠŸèƒ½ï¼)
# ==================================================
elif menu == "ğŸ‘§ äºˆå©•æƒ…ç·’é›·é”":
    st.title("ğŸ‘§ äºˆå©•æƒ…ç·’é›·é”")
    st.markdown("ç›£æ¸¬ç›®æ¨™æƒ…ç·’æ³¢å‹•ï¼Œæä¾›æœ€ä½³ç”Ÿå­˜/å®‰æ’«æˆ°ç•¥ã€‚")
    st.markdown("---")
    
    mood_score = st.slider("ç›®å‰æƒ…ç·’æŒ‡æ•¸ (0=æ¥µåº¦æ†¤æ€’, 100=é–‹å¿ƒæ’’å¬Œ)", 0, 100, 50)
    
    st.subheader("ğŸ›¡ï¸ æˆ°ç•¥åˆ†æå ±å‘Š")
    if mood_score < 30:
        st.error("ğŸš¨ è­¦å‘Šï¼šç´…è‰²è­¦æˆ’ï¼ç›®æ¨™æ¥µåº¦ä¸ç©©å®šã€‚")
        st.write("**å»ºè­°æˆ°è¡“ï¼š** é–‰å˜´ã€è²·å¥½åƒçš„ã€ä¸è¦è¬›é“ç†ã€‚ç«‹å³åŸ·è¡Œã€Œè£æ­»ã€æˆ–ã€Œè·ªç®—ç›¤ã€ç¨‹åºã€‚")
    elif mood_score < 70:
        st.warning("âš ï¸ ç‹€æ…‹ï¼šæ³¢å‹•ä¸­ã€‚æœ‰äº›å°æƒ…ç·’ã€‚")
        st.write("**å»ºè­°æˆ°è¡“ï¼š** å‚¾è½æ¨¡å¼é–‹å•Ÿã€‚å¥¹èªªä»€éº¼éƒ½å°ï¼Œé©æ™‚é™„å’Œï¼Œä¸è¦è©¦åœ–è§£æ±ºå•é¡Œï¼Œè§£æ±ºæƒ…ç·’å°±å¥½ã€‚")
    else:
        st.success("âœ… ç‹€æ…‹ï¼šæ™´ç©ºè¬é‡Œã€‚")
        st.write("**å»ºè­°æˆ°è¡“ï¼š** é©åˆæå‡ºè¦æ±‚ï¼ˆå¦‚è²·PS5æˆ–å»æ‰“ç‰Œï¼‰ã€‚ç¾åœ¨æ˜¯é€²æ”»çš„æœ€ä½³æ™‚æ©Ÿï¼")

# ==================================================
# 4. ğŸ”¢ è™Ÿç¢¼æŠ€è¡“åˆ†æ
# ==================================================
elif menu == "ğŸ”¢ è™Ÿç¢¼æŠ€è¡“åˆ†æ":
    st.title("ğŸ”¢ è™Ÿç¢¼æŠ€è¡“åˆ†æ")
    st.write("è¼¸å…¥è¿‘æœŸé–‹çè™Ÿç¢¼ï¼Œåˆ†æå†·ç†±è¶¨å‹¢ã€‚")
    st.text_input("è¼¸å…¥æ­·å²çè™Ÿ (ä»¥é€—è™Ÿåˆ†éš”)")
    st.bar_chart({"07": 5, "11": 3, "24": 8, "34": 2})
    st.caption("ç›®å‰ 24 è™Ÿç†±åº¦æœ€é«˜ï¼Œ34 è™Ÿè§¸åº•åå½ˆä¸­ã€‚")

# ==================================================
# 5. â³ ä»Šæ—¥æ™‚ç©ºæˆ°ç•¥
# ==================================================
elif menu == "â³ ä»Šæ—¥æ™‚ç©ºæˆ°ç•¥":
    st.title("â³ ä»Šæ—¥æ™‚ç©ºæˆ°ç•¥ (å¥‡é–€æµæ—¥)")
    today = datetime.date.today()
    st.info(f"ä»Šæ—¥æ—¥æœŸï¼š{today} (ä¸™åˆæ—¥)")
    st.write("""
    * **å‰æ™‚ï¼š** åˆæ™‚ (11-13)ã€æˆŒæ™‚ (19-21)
    * **è²¡ä½ï¼š** æ­£å—æ–¹
    * **ç”Ÿé–€ï¼š** æ±å—æ–¹
    * **ç´…è“®æç¤ºï¼š** ä»Šæ—¥ç«æ—ºï¼Œåˆ©ç´…è‰²è™Ÿç¢¼ (34)ï¼Œä¸”åˆ©ä¸»å‹•å‡ºæ“Šã€‚
    """)

# ==================================================
# 6. ğŸ‘¤ æ·±å±¤æœ¬å‘½è§£æ (é€™è£¡æ•´åˆäº†äººå¿ƒåˆ¤æ–·ç³»çµ±)
# ==================================================
elif menu == "ğŸ‘¤ æ·±å±¤æœ¬å‘½è§£æ (äººå¿ƒåˆ¤æ–·)":
    st.title("ğŸ‘ï¸ æ·±å±¤æœ¬å‘½è§£æãƒ»è­˜äººè¡“")
    st.markdown("è¼¸å…¥ç”Ÿæ—¥ï¼Œçœ‹ç©¿å°æ–¹çš„åº•å±¤é‚è¼¯èˆ‡ä½¿ç”¨èªªæ˜æ›¸ã€‚")
    
    c1, c2 = st.columns(2)
    with c1:
        name = st.text_input("å°è±¡ä»£è™Ÿ", "ç¥ç§˜äºº")
        b_date = st.date_input("å‡ºç”Ÿå¹´æœˆæ—¥", datetime.date(1996, 2, 17))
    with c2:
        mode = st.radio("åˆ†ææ¨¡å¼", ["äº¤å‹/çœ‹é€äººå¿ƒ", "é¢è©¦/è­˜äººç”¨äºº"])
        
    if st.button("ğŸ”¥ å•Ÿå‹•ç´…è“®è§£æ"):
        constellation, life_num, trait = get_human_analysis(b_date)
        
        st.divider()
        st.subheader(f"ğŸ¯ ç›®æ¨™ï¼š{name}")
        m1, m2, m3 = st.columns(3)
        m1.metric("æ˜Ÿåº§", constellation)
        m2.metric("ç”Ÿå‘½éˆæ•¸", f"{life_num} è™Ÿäºº")
        m3.metric("é—œéµç‰¹è³ª", trait.split("ã€‘")[0].replace("ã€", ""))
        
        st.markdown("### ğŸ“ ç´…è“®åˆ†æå ±å‘Š")
        st.info(trait)
        
        st.markdown("### ğŸ›¡ï¸ æˆ°è¡“å»ºè­°")
        if mode == "äº¤å‹/çœ‹é€äººå¿ƒ":
            st.write(f"é¢å°**{constellation}**çš„äººï¼Œè«‹ä¿æŒçœŸèª ã€‚{life_num}è™Ÿäººé€šå¸¸ç›´è¦ºå¾ˆæº–ï¼Œä¸è¦èªªè¬Šã€‚")
        else:
            st.write(f"æ­¤äººé©åˆæ”¾å°ä½ç½®ã€‚è‹¥ç”Ÿå‘½éˆæ•¸ç‚º 1, 5, 8 é©åˆé–‹å‰µï¼›4, 6 é©åˆå®ˆæˆã€‚")

# ==================================================
# 7. â¤ï¸ æƒ…å ´æˆ°ç•¥æŒ‡æ®éƒ¨
# ==================================================
elif menu == "â¤ï¸ æƒ…å ´æˆ°ç•¥æŒ‡æ®éƒ¨":
    st.title("â¤ï¸ æƒ…å ´æˆ°ç•¥æŒ‡æ®éƒ¨")
    st.write("åˆ†æé›™æ–¹å¥‘åˆåº¦èˆ‡ç•¶ä¸‹æ”»é˜²æˆ°ç•¥ã€‚")
    st.slider("é›™æ–¹è¦ªå¯†åº¦", 0, 100, 80)
    st.success("ç›®å‰é—œä¿‚ç©©å®šï¼Œå»ºè­°å®‰æ’ä¸€æ¬¡ç„¡ç›®çš„çš„æ—…è¡Œä»¥å¢æº«ã€‚")

# ==================================================
# 8. ğŸ¢ éˆé¾œå¤§å‰æ¸…å–®
# ==================================================
elif menu == "ğŸ¢ éˆé¾œå¤§å‰æ¸…å–® (æœ¬æœŸé‡é»)":
    st.title("ğŸ¢ éˆé¾œå¤§å‰ãƒ»å”¯ä¸€èªè­‰")
    st.balloons()
    st.success("### ğŸ”¥ æœ¬æœŸå”¯ä¸€ 5 é¡†å¤§å‰")
    st.markdown("""
    # **07ã€11ã€24ã€25ã€34**
    
    * **æ ¸å¿ƒä¸»æ˜Ÿï¼š** 34 (ç´…è‰²å›å½ˆ / ç«æ—º)
    * **æˆ°ç•¥è©•åƒ¹ï¼š** å”¯ä¸€å¤§å‰ï¼Œå»ºè­°é–å®šã€‚
    * **éˆé¾œæŒ‡ç¤ºï¼š** æ°£èšç¥å‡ï¼Œå‹¿ä¸‰å¿ƒäºŒæ„ã€‚
    """)
