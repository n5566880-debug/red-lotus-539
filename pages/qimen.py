import streamlit as st
import datetime
import math
import random
import pandas as pd
import numpy as np
import hashlib

# ==============================================================================
# ğŸ›¡ï¸ ç´…è“®æˆ°ç•¥ç³»çµ± V6.0 - å‘½é‹æç£ç‰ˆ (Red Lotus System V6.0 Ultimate Commander)
# ==============================================================================
# æ ¸å¿ƒæ¶æ§‹ï¼šé›™äººåˆç›¤ / åå¹´å¤§é™ / éˆé¾œå åœ / è³­ç‹æ±ºç­– / ç”Ÿç‰©ç¯€å¾‹
# ==============================================================================

st.set_page_config(page_title="ç´…è“®æˆ°ç•¥ V6.0", page_icon="ğŸ”¥", layout="wide")

# --- [è‡ªå®šç¾©è»äº‹é¢¨æ ¼ä»‹é¢] ---
st.markdown("""
<style>
    .big-font { font-size:22px !important; font-weight: bold; }
    .highlight { color: #ff4b4b; font-weight: bold; }
    .metric-box { background-color: #f1f2f6; padding: 15px; border-radius: 8px; border-left: 5px solid #ff4b4b; }
    .luck-cycle { background-color: #2d3436; color: white; padding: 10px; border-radius: 5px; margin-bottom: 5px; }
    .stProgress > div > div > div > div { background-color: #d63031; }
</style>
""", unsafe_allow_html=True)

# ==============================================================================
# [æ ¸å¿ƒé‹ç®—åº«] Red Lotus Core Intelligence (å…§å»ºæ›†æ³•èˆ‡å‘½ç†é‚è¼¯)
# ==============================================================================
class RedLotusCore:
    # åŸºç¤å¤©å¹²åœ°æ”¯
    GAN = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"]
    ZHI = ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"]
    ELEMENTS = {"ç”²": "æœ¨", "ä¹™": "æœ¨", "ä¸™": "ç«", "ä¸": "ç«", "æˆŠ": "åœŸ", "å·±": "åœŸ", "åºš": "é‡‘", "è¾›": "é‡‘", "å£¬": "æ°´", "ç™¸": "æ°´"}
    
    # äº”è¡Œç”Ÿå‰‹çŸ©é™£ (Rowç”Ÿ/å‰‹Col)
    RELATION_MATRIX = {
        "æœ¨": {"æœ¨": "æ¯”æ—º (æœ‹å‹)", "ç«": "æˆ‘ç”Ÿ (ä»˜å‡º)", "åœŸ": "æˆ‘å‰‹ (æŒæ§)", "é‡‘": "å‰‹æˆ‘ (å£“åŠ›)", "æ°´": "ç”Ÿæˆ‘ (è²´äºº)"},
        "ç«": {"æœ¨": "ç”Ÿæˆ‘ (è²´äºº)", "ç«": "æ¯”æ—º (æœ‹å‹)", "åœŸ": "æˆ‘ç”Ÿ (ä»˜å‡º)", "é‡‘": "æˆ‘å‰‹ (æŒæ§)", "æ°´": "å‰‹æˆ‘ (å£“åŠ›)"},
        "åœŸ": {"æœ¨": "å‰‹æˆ‘ (å£“åŠ›)", "ç«": "ç”Ÿæˆ‘ (è²´äºº)", "åœŸ": "æ¯”æ—º (æœ‹å‹)", "é‡‘": "æˆ‘ç”Ÿ (ä»˜å‡º)", "æ°´": "æˆ‘å‰‹ (æŒæ§)"},
        "é‡‘": {"æœ¨": "æˆ‘å‰‹ (æŒæ§)", "ç«": "å‰‹æˆ‘ (å£“åŠ›)", "åœŸ": "ç”Ÿæˆ‘ (è²´äºº)", "é‡‘": "æ¯”æ—º (æœ‹å‹)", "æ°´": "æˆ‘ç”Ÿ (ä»˜å‡º)"},
        "æ°´": {"æœ¨": "æˆ‘ç”Ÿ (ä»˜å‡º)", "ç«": "æˆ‘å‰‹ (æŒæ§)", "åœŸ": "å‰‹æˆ‘ (å£“åŠ›)", "é‡‘": "ç”Ÿæˆ‘ (è²´äºº)", "æ°´": "æ¯”æ—º (æœ‹å‹)"}
    }

    @staticmethod
    def get_gan_zhi(date):
        """è¨ˆç®—æ—¥æŸ±å¹²æ”¯ (åŸºæº–æ—¥ 1900-01-01 ç”²æˆŒ)"""
        base_date = datetime.date(1900, 1, 1)
        days = (date - base_date).days
        gan_idx = days % 10
        zhi_idx = (days + 10) % 12
        return RedLotusCore.GAN[gan_idx], RedLotusCore.ZHI[zhi_idx]

    @staticmethod
    def get_element_relation(my_date, target_date):
        """è¨ˆç®—é›™æ–¹æ—¥ä¸»é—œä¿‚"""
        my_gan, _ = RedLotusCore.get_gan_zhi(my_date)
        target_gan, _ = RedLotusCore.get_gan_zhi(target_date)
        
        my_el = RedLotusCore.ELEMENTS[my_gan]
        target_el = RedLotusCore.ELEMENTS[target_gan]
        
        relation = RedLotusCore.RELATION_MATRIX[my_el][target_el]
        return my_gan, my_el, target_gan, target_el, relation

    @staticmethod
    def calculate_kelly_criterion(win_prob, odds):
        """å‡±åˆ©å…¬å¼"""
        b = odds - 1
        p = win_prob
        q = 1 - p
        f = (b * p - q) / b if b > 0 else 0
        return max(f, 0)

    @staticmethod
    def get_biorhythm(birthdate):
        """ç”Ÿç‰©ç¯€å¾‹"""
        today = datetime.date.today()
        delta = (today - birthdate).days
        phy = math.sin(2 * math.pi * delta / 23) * 100
        emo = math.sin(2 * math.pi * delta / 28) * 100
        intel = math.sin(2 * math.pi * delta / 33) * 100
        return {"phy": phy, "emo": emo, "intel": intel}

    @staticmethod
    def get_decade_luck(birth_date):
        """
        [ç¨å®¶] åå¹´å¤§é™æ¨ç®— (æ¨¡æ“¬æ’ç›¤é‚è¼¯)
        æ ¹æ“šå‡ºç”Ÿå¹´å°¾æ•¸èˆ‡å­£ç¯€ï¼Œæ¨ç®—æœªä¾†é‹å‹¢èµ·ä¼
        """
        start_year = datetime.date.today().year
        element_cycle = ["æœ¨ (é–‹å‰µ)", "ç« (ç‡ƒç‡’)", "åœŸ (ç©©å›º)", "é‡‘ (è®Šé©)", "æ°´ (æ²ˆæ¾±)"]
        
        # ç°¡æ˜“èµ·é‹é‚è¼¯ï¼šä¾æ“šå‡ºç”Ÿå¹´å°¾æ•¸æ±ºå®šèµ·å§‹å…ƒç´ 
        seed = birth_date.year % 5 
        cycles = []
        
        for i in range(5):
            period = f"{start_year + i*10} ~ {start_year + (i+1)*10 - 1}"
            current_el = element_cycle[(seed + i) % 5]
            
            # æ ¹æ“šå…ƒç´ çµ¦å‡ºå¤§é™ä¸»é¡Œ
            desc = ""
            if "æœ¨" in current_el: desc = "å¤§é‹é—œéµï¼šã€å•Ÿå‹•ã€‘ã€‚é©åˆå‰µæ¥­ã€æ–°æ–¹å‘ï¼Œè²´äººåœ¨æ±æ–¹ã€‚"
            elif "ç«" in current_el: desc = "å¤§é‹é—œéµï¼šã€é¡¯åŒ–ã€‘ã€‚åè²å¤§å™ªï¼Œä½†éœ€æ³¨æ„æƒ…ç·’èˆ‡å¿ƒè¡€ç®¡ã€‚"
            elif "åœŸ" in current_el: desc = "å¤§é‹é—œéµï¼šã€ç´¯ç©ã€‘ã€‚ç½®ç”¢ã€å­˜éŒ¢ã€å®¶åº­ç©©å›ºï¼Œè®Šå‹•è¼ƒå°‘ã€‚"
            elif "é‡‘" in current_el: desc = "å¤§é‹é—œéµï¼šã€è‚…æ®ºã€‘ã€‚å¤§ç ´å¤§ç«‹ï¼Œè·ä½è®Šå‹•å¤§ï¼Œåˆ©æ–¼æŒæ¬Šã€‚"
            elif "æ°´" in current_el: desc = "å¤§é‹é—œéµï¼šã€æ½›è—ã€‘ã€‚å­¸ç¿’ã€é€²ä¿®ã€æµ·å¤–é‹ï¼Œä¸å®œå¼·å‡ºé ­ã€‚"
            
            cycles.append({"period": period, "theme": current_el, "desc": desc})
        return cycles

    @staticmethod
    def turtle_divination(question):
        """éˆé¾œå åœç®—æ³• (åŸºæ–¼æ™‚é–“ç¨®å­)"""
        if not question: return None
        # ä½¿ç”¨å•é¡Œé•·åº¦+æ™‚é–“å¾®ç§’ä½œç‚ºç¨®å­ï¼Œç¢ºä¿éš¨æ©Ÿæ€§
        seed = int(datetime.datetime.now().timestamp() * 1000) + len(question)
        random.seed(seed)
        
        results = [
            ("å¤§å‰", "ä¹¾å¦ - é£›é¾åœ¨å¤©", "æ™‚æ©Ÿæˆç†Ÿï¼Œå…¨åŠ›ä»¥èµ´ï¼Œå¿…æœ‰å›éŸ¿ã€‚"),
            ("ä¸­å‰", "é›¢å¦ - æ—­æ—¥æ±æ˜‡", "å‰é€”å…‰æ˜ï¼Œä½†éœ€é˜²å£èˆŒä¹‹çˆ­ã€‚"),
            ("å°å‰", "éœ‡å¦ - æ¯æœ¨é€¢æ˜¥", "é›–æœ‰æ³¢æŠ˜ï¼Œä½†è½‰æ©Ÿå·²ç¾ï¼Œè€å¿ƒç­‰å¾…ã€‚"),
            ("å¹³", "å…Œå¦ - éº—æ¾¤å…Œæ‚…", "ä¿æŒç¾ç‹€ï¼Œå¤šèˆ‡äººæºé€šï¼Œä¸å¯ç¨æ–·ã€‚"),
            ("å‡¶", "åå¦ - æ°´åº•æ’ˆæœˆ", "æ™‚æ©Ÿæœªåˆ°ï¼Œå¼·æ±‚ç„¡ç›Šï¼Œå»ºè­°ä¿å®ˆã€‚"),
            ("å¤§å‡¶", "å›°å¦ - æ¾¤æ°´å›°", "å››é¢æ¥šæ­Œï¼Œæš«æ™‚é€€å®ˆï¼Œä¸å¯å†’éšªã€‚")
        ]
        return random.choice(results)

# --- [UI å´é‚Šæ¬„] ---
st.sidebar.title("ğŸ”¥ ç´…è“® V6.0 å‘½é‹æç£")
st.sidebar.caption("Commander Access: GRANTED")
st.sidebar.markdown("---")

menu = st.sidebar.radio("ğŸ”° æˆ°è¡“æ¨¡çµ„", [
    "ğŸ° è³­ç‹æ±ºç­–ç³»çµ± (å°ˆæ¥­ç‰ˆ)", 
    "ğŸ“ˆ Kç·šè¶¨å‹¢åˆ†æ (å›æ­¸ç‰ˆ)",
    "ğŸ‘§ äºˆå©•æƒ…ç·’é›·é” (æ——è‰¦ç‰ˆ)", 
    "â¤ï¸ èˆŠæ„›è¤‡åˆ (é›™äººåˆç›¤ç‰ˆ)",
    "ğŸ‘¤ æœ¬å‘½è§£æ (è©³è§£+åå¹´å¤§é™)",
    "ğŸ¢ éˆé¾œå•äº‹ (å åœ+è™Ÿç¢¼)",
    "â³ ä»Šæ—¥æ™‚ç©º (æµæ—¥)"
])

# ==============================================================================
# 1. ğŸ° è³­ç‹æ±ºç­–ç³»çµ± (å°ˆæ¥­ç‰ˆ)
# ==============================================================================
if menu == "ğŸ° è³­ç‹æ±ºç­–ç³»çµ± (å°ˆæ¥­ç‰ˆ)":
    st.title("ğŸ° å°ˆæ¥­è³‡é‡‘æ§ç®¡ãƒ»æˆ°è¡“çµ‚ç«¯")
    st.markdown("### Professional Gambling Strategy System")
    st.markdown("---")
    
    c1, c2, c3 = st.columns(3)
    numbers = c1.text_input("ğŸ“ é–å®šè™Ÿç¢¼", "07, 11, 24, 25, 34")
    budget = c2.number_input("ğŸ’° æˆ°å‚™è³‡é‡‘", 2000, step=100)
    odds = c3.number_input("âš¡ å¹³å‡è³ ç‡", 5.0) 
    
    win_prob = st.slider("ğŸ“Š é ä¼°å‹ç‡ (Win Rate)", 0.0, 1.0, 0.25)
    
    # å‡±åˆ©å…¬å¼
    kelly = RedLotusCore.calculate_kelly_criterion(win_prob, odds)
    kelly_pct = kelly * 100
    
    # ç´…è“®æ¬Šé‡
    risk_adj = 0.8 
    final_pct = kelly_pct * risk_adj
    if "34" in numbers: final_pct += 2.5 
    
    final_pct = min(max(final_pct, 1.0), 10.0)
    
    st.markdown("### ğŸ›¡ï¸ æ±ºç­–å„€è¡¨æ¿")
    m1, m2, m3 = st.columns(3)
    m1.metric("å»ºè­°ä¸‹æ³¨æ¯”ä¾‹", f"{final_pct:.2f}%", "Kelly Optimized")
    m2.metric("å–®æ³¨é‡‘é¡", f"${budget * final_pct / 100:.0f}", "Risk Control")
    m3.metric("æ ¸å¿ƒä»£ç¢¼", "34", "Detected" if "34" in numbers else "None")
    
    if "34" in numbers:
        st.success("ğŸ”¥ **æ ¸å¿ƒä»£ç¢¼ 34 (ç«/å›å½ˆ)**ï¼šç³»çµ±åµæ¸¬åˆ°é«˜èƒ½é‡è™Ÿç¢¼ï¼Œå»ºè­°ä½œç‚ºè†½è™Ÿä½¿ç”¨ã€‚")

# ==============================================================================
# 2. ğŸ“ˆ Kç·šè¶¨å‹¢åˆ†æ (å›æ­¸ç‰ˆ)
# ==============================================================================
elif menu == "ğŸ“ˆ Kç·šè¶¨å‹¢åˆ†æ (å›æ­¸ç‰ˆ)":
    st.title("ğŸ“ˆ Kç·šè¶¨å‹¢åˆ†æãƒ»æ•¸å­—æˆ°æƒ…å®¤")
    st.markdown("è¼¸å…¥æ­·å²é–‹çæ•¸å­—ï¼Œåˆ†æå†·ç†±è¶¨å‹¢èˆ‡æ³¢æ®µã€‚")
    
    input_data = st.text_area("è¼¸å…¥è¿‘æœŸæ•¸å­— (ä»¥é€—è™Ÿåˆ†éš”)", 
                              "34, 25, 24, 11, 07, 34, 28, 05, 12, 34, 25, 07, 07, 11, 24")
    
    if input_data:
        try:
            data_list = [int(x.strip()) for x in input_data.split(",")]
            df = pd.DataFrame(data_list, columns=["Number"])
            df['MA3'] = df['Number'].rolling(3).mean()
            df['MA5'] = df['Number'].rolling(5).mean()
            
            st.line_chart(df[['Number', 'MA3', 'MA5']])
            
            last_num = data_list[-1]
            if last_num == 34:
                st.success("ğŸ”¥ **æŠ€è¡“é¢ç¢ºèª**ï¼š34 è™Ÿå‡ºç¾é »ç‡ä¸Šå‡ï¼Œç¬¦åˆå›å½ˆç‰¹å¾µã€‚")
            else:
                st.info(f"ğŸ“Š ç›®å‰æœ€å¾Œä¸€æœŸç‚º {last_num}ï¼Œå‡ç·šéœ‡ç›ªä¸­ã€‚")
        except:
            st.error("æ ¼å¼éŒ¯èª¤ï¼Œè«‹è¼¸å…¥ç´”æ•¸å­—ã€‚")

# ==============================================================================
# 3. ğŸ‘§ äºˆå©•æƒ…ç·’é›·é” (æ——è‰¦ç‰ˆ - 1997/03/21 åˆæ™‚)
# ==============================================================================
elif menu == "ğŸ‘§ äºˆå©•æƒ…ç·’é›·é” (æ——è‰¦ç‰ˆ)":
    st.title("ğŸ‘§ äºˆå©•æƒ…ç·’é›·é”ãƒ»æ——è‰¦è§£æ")
    
    yj_birth = datetime.date(1997, 3, 21)
    today = datetime.date.today()
    bio = RedLotusCore.get_biorhythm(yj_birth)
    
    st.markdown(f"""
    <div class="metric-box">
    <b>Target:</b> Yu-Jie (äºˆå©•) <br>
    <b>Birthday:</b> 1997/03/21 (åˆæ™‚) <br>
    <b>ä»Šæ—¥ç‹€æ…‹:</b> æƒ…ç·’å€¼ {bio['emo']:.1f}
    </div>
    """, unsafe_allow_html=True)
    st.markdown("---")
    
    c1, c2, c3 = st.columns(3)
    
    emo_state = "ğŸ˜ å¹³ç©©"
    if bio['emo'] > 50: emo_state = "ğŸ˜ é–‹å¿ƒ (High)"
    elif bio['emo'] < -50: emo_state = "ğŸ˜¡ æš´èº (Low)"
    
    c1.metric("â¤ï¸ æƒ…ç·’æŒ‡æ•¸", f"{bio['emo']:.1f}", emo_state)
    c2.metric("âš¡ é«”åŠ›æŒ‡æ•¸", f"{bio['phy']:.1f}", "å……æ²›" if bio['phy']>0 else "ç–²å‹")
    c3.metric("ğŸ§  æ™ºåŠ›æŒ‡æ•¸", f"{bio['intel']:.1f}", "æ¸…æ™°" if bio['intel']>0 else "é²éˆ")
    
    st.progress((bio['emo'] + 100) / 200)
    
    # å¥‡é–€æ™‚ç©ºç–ŠåŠ 
    gan, zhi = RedLotusCore.get_gan_zhi(today)
    st.subheader(f"ğŸ”® ä»Šæ—¥æ™‚ç©º ({gan}{zhi}æ—¥) æ”»ç•¥")
    if bio['emo'] < -30:
        st.error("ğŸš¨ **ç´…è‰²è­¦æˆ’**ï¼šä»Šæ—¥æƒ…ç·’ä½è½ï¼Œä¸”é€¢æµæ—¥éœ‡ç›ªã€‚çµ•å°ç¦æ­¢ç¢ç¢å¿µã€‚")
        st.write("ğŸ‘‰ **æœ€ä½³è§£**ï¼šè²·å¥½åƒçš„ï¼Œå®‰éœé™ªåœ¨æ—é‚Šï¼Œä¸è¦è©¦åœ–è¬›é“ç†ã€‚")
    elif bio['emo'] > 30:
        st.success("âœ… **ç¶ è‰²é€šé“**ï¼šå¿ƒæƒ…å¥½ï¼Œé©åˆé€²æ”»ï¼")
        st.write("ğŸ‘‰ **æœ€ä½³è§£**ï¼šå¯ä»¥æå‡ºæ¯”è¼ƒéåˆ†çš„è¦æ±‚ï¼ˆèª¤ï¼‰ï¼Œæˆ–æ˜¯ç´„æœƒã€‚")
    else:
        st.warning("âš ï¸ **é»ƒè‰²è§€å¯Ÿ**ï¼šä¸€èˆ¬ç‹€æ…‹ï¼Œä¿æŒæ­£å¸¸äº’å‹•å³å¯ã€‚")

# ==============================================================================
# 4. â¤ï¸ èˆŠæ„›è¤‡åˆ (é›™äººåˆç›¤ç‰ˆ)
# ==============================================================================
elif menu == "â¤ï¸ èˆŠæ„›è¤‡åˆ (é›™äººåˆç›¤ç‰ˆ)":
    st.title("â¤ï¸ èˆŠæ„›è¤‡åˆãƒ»é›™äººåˆç›¤æˆ°ç•¥")
    st.markdown("è¼¸å…¥é›™æ–¹ç”Ÿæ—¥ï¼Œåˆ©ç”¨äº”è¡Œç”Ÿå‰‹è¨ˆç®—çœŸå¯¦é—œä¿‚èˆ‡è¤‡åˆæ©Ÿç‡ã€‚")
    
    c1, c2 = st.columns(2)
    my_dob = c1.date_input("ä½ çš„ç”Ÿæ—¥", datetime.date(1996, 2, 17))
    ex_dob = c2.date_input("å°æ–¹ç”Ÿæ—¥", datetime.date(1997, 3, 21))
    
    breakup_days = st.slider("åˆ†æ‰‹å¤©æ•¸", 1, 365, 30)
    
    if st.button("ğŸ’” å•Ÿå‹•åˆç›¤æ¨æ¼”"):
        # è¨ˆç®—é—œä¿‚
        m_gan, m_el, t_gan, t_el, relation = RedLotusCore.get_element_relation(my_dob, ex_dob)
        
        st.divider()
        st.subheader("ğŸ”® äº”è¡Œèƒ½é‡é—œä¿‚")
        
        k1, k2, k3 = st.columns(3)
        k1.metric("ä½ çš„æ—¥ä¸»", f"{m_gan} ({m_el})")
        k2.metric("å°æ–¹æ—¥ä¸»", f"{t_gan} ({t_el})")
        k3.metric("äº’å‹•æ¨¡å¼", relation)
        
        # è¤‡åˆåˆ†æ
        score = 60
        if "è²´äºº" in relation: score += 20
        elif "æ¯”æ—º" in relation: score += 10
        elif "å‰‹æˆ‘" in relation: score -= 15
        elif "æˆ‘å‰‹" in relation: score += 5  # æŒæ§æ¬Šåœ¨è‡ªå·±ï¼Œç®—å¥½äº‹
        
        if breakup_days > 180: score -= 20
        elif breakup_days < 60: score += 10
        
        st.markdown(f"### ğŸ›¡ï¸ æˆ°ç•¥åˆ†æ ({score}%)")
        
        if "ç”Ÿæˆ‘" in relation:
            st.success(f"âœ… **å„ªå‹¢åœ¨æˆ‘**ï¼šå°æ–¹ ({t_el}) å¤©ç”Ÿæœƒå¿ä¸ä½å°ä½  ({m_el}) å¥½ã€‚é€™æ®µé—œä¿‚ä½ æ˜¯è¢«æ„›çš„ä¸€æ–¹ã€‚åªè¦ä½ çµ¦å€‹å°éšï¼Œè¤‡åˆæ©Ÿç‡å¾ˆé«˜ã€‚")
        elif "æˆ‘ç”Ÿ" in relation:
            st.warning(f"âš ï¸ **è¾›è‹¦ä»˜å‡º**ï¼šä½  ({m_el}) å°å°æ–¹ ({t_el}) ä»˜å‡ºå¾ˆå¤šï¼Œå°æ–¹ç¿’æ…£æ¥å—ã€‚å¦‚æœè¦è¤‡åˆï¼Œä½ éœ€è¦å±•ç¾ã€Œä¸å¯å–ä»£ã€çš„åƒ¹å€¼ï¼Œè€Œä¸åªæ˜¯ç•¶å¥½äººã€‚")
        elif "æˆ‘å‰‹" in relation:
            st.info(f"âš¡ **æŒæ§å¤§å±€**ï¼šä½  ({m_el}) æœ¬è³ªä¸Šå£“åˆ¶å°æ–¹ ({t_el})ã€‚å°æ–¹å…¶å¯¦æœ‰é»æ€•ä½ æˆ–æœä½ ã€‚ç”¨å¼·å‹¢ä¸€é»çš„æº«æŸ”ï¼ˆéœ¸ç¸½æ¨¡å¼ï¼‰å»æŒ½å›ã€‚")
        elif "å‰‹æˆ‘" in relation:
            st.error(f"ğŸ›‘ **å£“åŠ›å±±å¤§**ï¼šå°æ–¹ ({t_el}) åƒå®šä½  ({m_el}) äº†ã€‚ä½ åœ¨é€™æ®µé—œä¿‚å¾ˆå‘å¾®ã€‚å»ºè­°å…ˆå†·è™•ç†ï¼Œæå‡è‡ªå·±æ°£å ´ï¼Œå¦å‰‡è¤‡åˆä¹Ÿæ˜¯é‡è¹ˆè¦†è½ã€‚")
        else:
            st.info(f"ğŸ¤ **æœ‹å‹é—œä¿‚**ï¼šäº”è¡Œç›¸åŒï¼Œåƒæœ‹å‹ä¸€æ¨£ã€‚ç¼ºä¹æ¿€æƒ…ä½†å¥½æºé€šã€‚å»ºè­°å¾æœ‹å‹åšèµ·ï¼Œé‡æ–°å¸å¼•ã€‚")

# ==============================================================================
# 5. ğŸ‘¤ æœ¬å‘½è§£æ (è©³è§£+åå¹´å¤§é™)
# ==============================================================================
elif menu == "ğŸ‘¤ æœ¬å‘½è§£æ (è©³è§£+åå¹´å¤§é™)":
    st.title("ğŸ‘ï¸ æœ¬å‘½è§£æãƒ»å‘½é‹æç£")
    st.markdown("å…¨æ–¹ä½è§£æï¼šæ€§æ ¼ã€äº¤å‹ã€é¢è©¦ã€ä»¥åŠæœªä¾†åå¹´å¤§é‹ã€‚")
    
    col1, col2 = st.columns(2)
    b_date = col1.date_input("å‡ºç”Ÿå¹´æœˆæ—¥", datetime.date(1996, 2, 17))
    b_time_check = col2.checkbox("ä¸ç¢ºå®šæ™‚è¾° (ä¸€èˆ¬æ¨¡å¼)", value=True)
    
    if st.button("ğŸ”¥ å•Ÿå‹•å…¨æ¯å‘½ç›¤"):
        gan, zhi = RedLotusCore.get_gan_zhi(b_date)
        element = RedLotusCore.ELEMENTS[gan]
        
        st.divider()
        st.markdown(f"### ğŸ¯ å‘½ä¸»æ ¸å¿ƒï¼šã€{gan} {element}ã€‘")
        
        # è©³ç´°æ€§æ ¼è³‡æ–™åº«
        traits_detailed = {
            "ç”²": ("åƒå¤©å¤§æ¨¹", "æ­£ç›´ã€ä¸å±ˆã€æœ‰é ˜è¢–æ°£è³ªã€‚", "èª æ‡‡ç›´ç‡ï¼Œä¸å–œæ­¡ç©å¿ƒæ©Ÿã€‚", "é©åˆç®¡ç†è·ã€å‰µæ¥­ï¼Œå±•ç¾æ“”ç•¶ã€‚"),
            "ä¹™": ("èŠ±è‰è—¤è”“", "éˆæ´»ã€é©æ‡‰åŠ›å¼·ã€å–„äº¤éš›ã€‚", "æº«æŸ”é«”è²¼ï¼Œä½†å®¹æ˜“å—ç’°å¢ƒå½±éŸ¿ã€‚", "é©åˆæ¥­å‹™ã€å¹•åƒšï¼Œå±•ç¾æŸ”è»Ÿèº«æ®µã€‚"),
            "ä¸™": ("å¤ªé™½ä¹‹ç«", "ç†±æƒ…ã€æ€¥èºã€è—ä¸ä½è©±ã€‚", "ä¸»å‹•ã€å¤§æ–¹ï¼Œå®¹æ˜“æˆç‚ºç„¦é»ã€‚", "é©åˆå…¬é—œã€æ¼”è—ã€éŠ·å”®ï¼Œå±•ç¾ç†±æƒ…ã€‚"),
            "ä¸": ("ç‡ˆç‡­ä¹‹ç«", "ç´°è†©ã€æ•æ„Ÿã€æ´å¯ŸåŠ›å¼·ã€‚", "æ…¢ç†±ä½†æ·±æƒ…ï¼Œçœ‹äººå¾ˆæº–ã€‚", "é©åˆç­–åŠƒã€åˆ†æã€å¿ƒç†è«®è©¢ã€‚", "â˜… ç´…è“®è¨»ï¼šæ­¤ç‚ºä½ çš„å‘½æ ¼ï¼Œæ¥µå…¶æ•éŠ³ã€‚"),
            "æˆŠ": ("é«˜å±±ä¹‹åœŸ", "æ²ˆç©©ã€å®ˆä¿¡ã€åæ‡‰è¼ƒæ…¢ã€‚", "åŒ…å®¹åŠ›å¼·ï¼Œçµ¦äººå®‰å…¨æ„Ÿã€‚", "é©åˆå€‰å„²ã€éŠ€è¡Œã€æˆ¿ç”¢ï¼Œå±•ç¾ç©©é‡ã€‚"),
            "å·±": ("ç”°åœ’ä¹‹åœŸ", "å…§æ–‚ã€å¤šç–‘ã€åšäº‹æœ‰æ¢ç†ã€‚", "ç´°å¿ƒå‘µè­·ï¼Œä½†å¿ƒé˜²è¼ƒé‡ã€‚", "é©åˆç§˜æ›¸ã€è­·ç†ã€æ•™è‚²ï¼Œå±•ç¾è€å¿ƒã€‚"),
            "åºš": ("åˆ€åŠä¹‹é‡‘", "å‰›æ¯…ã€è¬›ç¾©æ°£ã€åƒè»Ÿä¸åƒç¡¬ã€‚", "ç›´æ¥ã€éœ¸æ°£ï¼Œä¿è­·æ…¾å¼·ã€‚", "é©åˆè»è­¦ã€æ³•å‹™ã€å·¥ç¨‹ï¼Œå±•ç¾é­„åŠ›ã€‚"),
            "è¾›": ("ç å¯¶ä¹‹é‡‘", "å„ªé›…ã€æ„›é¢å­ã€å£æ‰å¥½ã€‚", "é‡è¦–è³ªæ„Ÿï¼Œæœ‰é»å°å‚²å¬Œã€‚", "é©åˆè¨­è¨ˆã€ç²¾å“ã€å¤–äº¤ï¼Œå±•ç¾å“å‘³ã€‚"),
            "å£¬": ("æ±Ÿæ²³ä¹‹æ°´", "è°æ˜ã€å–„è®Šã€å¥”æ”¾ã€‚", "é¢¨è¶£å¹½é»˜ï¼Œä½†ä¸å–œæ­¡è¢«ç®¡ã€‚", "é©åˆè²¿æ˜“ã€é‹è¼¸ã€å‰µæ„ï¼Œå±•ç¾éˆæ´»ã€‚"),
            "ç™¸": ("é›¨éœ²ä¹‹æ°´", "æº«æŸ”ã€å…§å‘ã€å¿ƒæ€æ·±æ²ˆã€‚", "å–„è§£äººæ„ï¼Œä½†æƒ…ç·’å…§è€—ã€‚", "é©åˆç ”ç©¶ã€å¹•å¾Œã€ç„å­¸ï¼Œå±•ç¾æ·±åº¦ã€‚")
        }
        
        title, char, social, interview = traits_detailed[gan]
        
        # é¡¯ç¤ºä¸‰å¤§æ¿å¡Š
        c1, c2, c3 = st.columns(3)
        with c1:
            st.info(f"**ã€æœ¬æ€§åº•ç‰Œã€‘**\n\n{char}")
        with c2:
            st.success(f"**ã€äº¤å‹/æˆ€æ„›ç‹€æ…‹ã€‘**\n\n{social}")
        with c3:
            st.warning(f"**ã€é¢è©¦/è·å ´å„ªå‹¢ã€‘**\n\n{interview}")
            
        # åå¹´å¤§é™
        st.markdown("### ğŸ—“ï¸ æœªä¾†åå¹´å¤§é‹ (Trend Cycles)")
        cycles = RedLotusCore.get_decade_luck(b_date)
        
        for cycle in cycles:
            st.markdown(f"""
            <div class="luck-cycle">
            <b>{cycle['period']}</b> | é‹å‹¢ä¸»é¡Œï¼š<span style="color:#ff7675">{cycle['theme']}</span> <br>
            {cycle['desc']}
            </div>
            """, unsafe_allow_html=True)

# ==============================================================================
# 6. ğŸ¢ éˆé¾œå•äº‹ (å åœ+è™Ÿç¢¼)
# ==============================================================================
elif menu == "ğŸ¢ éˆé¾œå•äº‹ (å åœ+è™Ÿç¢¼)":
    st.title("ğŸ¢ éˆé¾œå åœãƒ»å‰å‡¶æŒ‡å¼•")
    st.markdown("é™¤äº†å¤§å‰è™Ÿç¢¼ï¼Œéˆé¾œç¾åœ¨èƒ½å›ç­”ä½ å¿ƒä¸­çš„ç–‘æƒ‘ã€‚")
    
    # 1. å åœåŠŸèƒ½
    st.subheader("ğŸ—£ï¸ éˆé¾œå•äº‹")
    question = st.text_input("è¼¸å…¥ä½ çš„å•é¡Œ (ä¾‹å¦‚ï¼šé€™å€‹åˆä½œæ¡ˆæœƒæˆå—ï¼Ÿ)")
    
    if st.button("ğŸ”® æ“²ç­Šè«‹ç¤º"):
        if not question:
            st.warning("è«‹å…ˆè¼¸å…¥å•é¡Œï¼Œéˆé¾œæ‰èƒ½æ„Ÿæ‡‰ã€‚")
        else:
            st.spinner("éˆé¾œæ„Ÿæ‡‰ä¸­...")
            result = RedLotusCore.turtle_divination(question)
            
            st.divider()
            c1, c2 = st.columns([1, 3])
            c1.markdown(f"## {result[0]}")
            c2.info(f"**å¦è±¡ï¼š{result[1]}**\n\nç±¤è©©ï¼š{result[2]}")
            
            if "å‰" in result[0]:
                st.balloons()
    
    st.markdown("---")
    
    # 2. æœ¬æœŸè™Ÿç¢¼ (ä¿ç•™å¤§å‰)
    st.subheader("ğŸ”¥ æœ¬æœŸå”¯ä¸€ 5 é¡†å¤§å‰")
    st.markdown("""
    <div style="text-align: center; font-size: 48px; font-weight: bold; color: #d63031; background-color: #ffeaa7; padding: 20px; border-radius: 15px;">
    07ã€11ã€24ã€25ã€34
    </div>
    """, unsafe_allow_html=True)
    
    c1, c2 = st.columns(2)
    with c1:
        st.error("ğŸ”¥ **æ ¸å¿ƒä¸»æ˜Ÿï¼š34**")
        st.write("å±¬æ€§ï¼šç´…è‰² / é›™æ•¸ / ç«ã€‚\næ„ç¾©ï¼šå›å½ˆè‡¨ç•Œé»ï¼Œå‹¢ä¸å¯æ“‹ã€‚")
    with c2:
        st.info("ğŸ›¡ï¸ **è­·æ³•é™£å‹**")
        st.write("07 (åŒæº), 11 (æ”¯æ’), 24/25 (é€£è™Ÿé˜²å®ˆ)ã€‚")

# ==============================================================================
# 7. â³ ä»Šæ—¥æ™‚ç©º (æµæ—¥)
# ==============================================================================
elif menu == "â³ ä»Šæ—¥æ™‚ç©º (æµæ—¥)":
    today = datetime.date.today()
    gan, zhi = RedLotusCore.get_gan_zhi(today)
    
    st.title(f"â³ ä»Šæ—¥æ™‚ç©ºï¼š{today}")
    st.subheader(f"ä»Šæ—¥å¹²æ”¯ï¼šã€{gan}{zhi}ã€‘æ—¥")
    
    c1, c2 = st.columns(2)
    c1.markdown("#### ğŸŒ èƒ½é‡åˆ†æ")
    c1.write(f"ä»Šæ—¥å¤©å¹²ç‚º **{gan}**ï¼Œäº”è¡Œå±¬ **{RedLotusCore.ELEMENTS[gan]}**ã€‚")
    if RedLotusCore.ELEMENTS[gan] == "ç«":
        c1.success("ğŸ”¥ ç«æ—ºä¹‹æ—¥ï¼å¤§åˆ© 34 è™Ÿ (ç´…è‰²)ã€‚ç©æ¥µé€²æ”»ï¼")
    else:
        c1.info("ä¾ç…§äº”è¡Œç”Ÿå‰‹èª¿æ•´ç­–ç•¥ã€‚")
        
    c2.markdown("#### ğŸ•°ï¸ å¥‡é–€å‰æ™‚")
    c2.write("1. **åˆæ™‚ (11-13)**ï¼šæ—¥ç¥¿æ­¸æ™‚ï¼Œè²¡æ°£æœ€æ—ºã€‚")
    c2.write("2. **æˆŒæ™‚ (19-21)**ï¼šä¸‰å¥‡åˆ°æ®¿ï¼Œéˆæ„Ÿæœ€å¼·ã€‚")

st.markdown("---")
st.caption("Powered by Red Lotus System V6.0 | Commander Edition")
