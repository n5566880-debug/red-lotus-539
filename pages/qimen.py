import streamlit as st
import datetime
import math
import random
import pandas as pd
import numpy as np

# ==============================================================================
# ğŸ›¡ï¸ ç´…è“®æˆ°ç•¥ç³»çµ± V5.0 - è¬è±¡å¤©ç¾…ç‰ˆ (Red Lotus System V5.0 Ultimate)
# ==============================================================================
# æ¶æ§‹ï¼šå¥‡é–€éç”²æ ¸å¿ƒ / è³­ç‹æ±ºç­– / Kç·šåˆ†æ / ç”Ÿç‰©ç¯€å¾‹ / è¤‡åˆæˆ°ç•¥
# ==============================================================================

st.set_page_config(page_title="ç´…è“®æˆ°ç•¥ V5.0", page_icon="ğŸ”¥", layout="wide")

# --- [è‡ªå®šç¾©æ¨£å¼] ---
st.markdown("""
<style>
    .big-font { font-size:20px !important; font-weight: bold; }
    .qimen-box { background-color: #2d3436; color: #dfe6e9; padding: 10px; border-radius: 5px; border-left: 5px solid #d63031; }
    .stMetric { background-color: #f1f2f6; padding: 10px; border-radius: 5px; }
</style>
""", unsafe_allow_html=True)

# ==============================================================================
# [æ ¸å¿ƒé‹ç®—åº«] Red Lotus Core Intelligence (å…§å»ºå¥‡é–€æ›†æ³•)
# ==============================================================================
class RedLotusCore:
    # åŸºç¤å¤©å¹²åœ°æ”¯è³‡æ–™
    GAN = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"]
    ZHI = ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"]
    
    # å¥‡é–€å…«é–€ / ä¹æ˜Ÿ / å…«ç¥
    DOORS = ["ä¼‘é–€ (å‰)", "æ­»é–€ (å‡¶)", "å‚·é–€ (å‡¶)", "æœé–€ (å¹³)", "é–‹é–€ (å‰)", "é©šé–€ (å‡¶)", "ç”Ÿé–€ (å‰)", "æ™¯é–€ (å¹³)"]
    STARS = ["å¤©è“¬", "å¤©ä»»", "å¤©æ²–", "å¤©è¼”", "å¤©è‹±", "å¤©èŠ®", "å¤©æŸ±", "å¤©å¿ƒ", "å¤©ç¦½"]
    GODS = ["å€¼ç¬¦", "é¨°è›‡", "å¤ªé™°", "å…­åˆ", "ç™½è™", "ç„æ­¦", "ä¹åœ°", "ä¹å¤©"]

    @staticmethod
    def get_gan_zhi(date):
        """è¨ˆç®—æ—¥æŸ±å¹²æ”¯ (ç°¡æ˜“ç®—æ³•)"""
        base_date = datetime.date(1900, 1, 1) # ç”²æˆŒæ—¥
        days = (date - base_date).days
        gan_idx = (days) % 10
        zhi_idx = (days + 10) % 12 # æ ¡æ­£åç§»
        return RedLotusCore.GAN[gan_idx], RedLotusCore.ZHI[zhi_idx]

    @staticmethod
    def get_qimen_chart(date, hour_gan="ç”²"):
        """æ¨¡æ“¬å¥‡é–€æ’ç›¤ (åŸºæ–¼æ—¥å¹²æ”¯èˆ‡æ™‚è¾°)"""
        # é€™è£¡ä½¿ç”¨éš¨æ©Ÿå“ˆå¸Œæ¨¡æ“¬æ’ç›¤é‚è¼¯ï¼Œç¢ºä¿åŒä¸€å¤©åŒä¸€æ™‚è¾°çµæœå›ºå®šï¼Œä½†ä¸éœ€é¾å¤§æ˜Ÿæ›†è¡¨
        seed = date.year * 10000 + date.month * 100 + date.day
        random.seed(seed)
        
        layout = {
            "door": random.choice(RedLotusCore.DOORS),
            "star": random.choice(RedLotusCore.STARS),
            "god": random.choice(RedLotusCore.GODS),
            "luck": random.randint(40, 95)
        }
        return layout

    @staticmethod
    def get_biorhythm(birthdate):
        """ç”Ÿç‰©ç¯€å¾‹è¨ˆç®— (é«”åŠ›23, æƒ…ç·’28, æ™ºåŠ›33)"""
        today = datetime.date.today()
        delta = (today - birthdate).days
        phy = math.sin(2 * math.pi * delta / 23) * 100
        emo = math.sin(2 * math.pi * delta / 28) * 100
        intel = math.sin(2 * math.pi * delta / 33) * 100
        return {"phy": phy, "emo": emo, "intel": intel}

    @staticmethod
    def analyze_love_qimen(gan_day, gan_year):
        """å¥‡é–€è¤‡åˆåˆ†æé‚è¼¯ (ä¹™åºšä¸ä¸™)"""
        # æ¨¡æ“¬åˆ†æ
        relation_score = 60
        analysis_text = []
        
        # ä¹™(å¥³) åºš(ç”·) é—œä¿‚
        if gan_day in ["ç”²", "ä¹™"] and gan_year in ["åºš", "è¾›"]:
            analysis_text.append("ğŸ›‘ **ä¹™åºšç›¸å‰‹**ï¼šé›™æ–¹æ€§æ ¼ç›®å‰è™•æ–¼å°ç«‹é¢ï¼Œæºé€šå®¹æ˜“æœ‰ç«æ°£ã€‚")
            relation_score -= 15
        elif gan_day in ["ä¹™"] and gan_year in ["åºš"]:
             analysis_text.append("â¤ï¸ **ä¹™åºšç›¸åˆ**ï¼šé€™æ˜¯å¥‡é–€ä¸­çš„ã€åˆæ ¼ã€ï¼Œä»£è¡¨ç·£åˆ†æœªæ–·ï¼Œæœ‰å¼·åŠ›ç¾ˆçµ†ã€‚")
             relation_score += 30
        else:
            analysis_text.append("âš–ï¸ **æ¯”å’Œç‹€æ…‹**ï¼šé—œä¿‚å¹³æ·¡ï¼Œéœ€è¦å¤–åŠ›æ¨å‹•ã€‚")
        
        # å…­åˆ (é—œä¿‚å®®)
        rand_god = random.choice(RedLotusCore.GODS)
        if rand_god == "å…­åˆ":
            analysis_text.append("âœ¨ **å…­åˆè½å®®**ï¼šã€å…­åˆã€ä»£è¡¨å©šå§»èˆ‡çµåˆï¼Œå‡ºç¾åœ¨å±€ä¸­æ˜¯å¤§å‰ä¹‹å…†ã€‚")
            relation_score += 25
        elif rand_god == "ç™½è™":
            analysis_text.append("âš”ï¸ **ç™½è™è‡¨é–€**ï¼šå£“åŠ›å¤§ï¼Œæœ‰çˆ­åµæˆ–å—å‚·çš„é¢¨éšªï¼Œåˆ‡å‹¿æ€¥èºã€‚")
            relation_score -= 20
        else:
            analysis_text.append(f"ğŸŒ€ **å®ˆè­·ç¥ï¼š{rand_god}**ã€‚å½±éŸ¿ä¸­æ€§ã€‚")
            
        return max(min(relation_score, 99), 10), analysis_text

# --- [UI ä»‹é¢] ---
st.sidebar.title("ğŸ”¥ ç´…è“® V5.0 è¬è±¡å¤©ç¾…")
st.sidebar.caption("Commander Access: GRANTED")
st.sidebar.markdown("---")

menu = st.sidebar.radio("ğŸ”° æˆ°è¡“æ¨¡çµ„", [
    "ğŸ° è³­ç‹æ±ºç­–ç³»çµ± (å°ˆæ¥­ç‰ˆ)", 
    "ğŸ“ˆ Kç·šè¶¨å‹¢åˆ†æ (å›æ­¸ç‰ˆ)",
    "ğŸ‘§ äºˆå©•æƒ…ç·’é›·é” (æ——è‰¦ç‰ˆ)", 
    "â¤ï¸ èˆŠæ„›è¤‡åˆ (å¥‡é–€éç”²ç‰ˆ)",
    "ğŸ‘¤ æœ¬å‘½è§£æ (å¥‡é–€éç”²ç‰ˆ)",
    "ğŸ¢ éˆé¾œå¤§å‰ (æœ¬æœŸæ ¸å¿ƒ)",
    "â³ ä»Šæ—¥æ™‚ç©º (æµæ—¥)"
])

# ==============================================================================
# 1. ğŸ° è³­ç‹æ±ºç­–ç³»çµ± (å°ˆæ¥­ç‰ˆ - å«å‡±åˆ©å…¬å¼)
# ==============================================================================
if menu == "ğŸ° è³­ç‹æ±ºç­–ç³»çµ± (å°ˆæ¥­ç‰ˆ)":
    st.title("ğŸ° å°ˆæ¥­è³‡é‡‘æ§ç®¡ãƒ»æˆ°è¡“çµ‚ç«¯")
    st.markdown("---")
    
    c1, c2, c3 = st.columns(3)
    numbers = c1.text_input("ğŸ“ é–å®šè™Ÿç¢¼", "07, 11, 24, 25, 34")
    budget = c2.number_input("ğŸ’° æˆ°å‚™è³‡é‡‘", 2000, step=100)
    odds = c3.number_input("âš¡ å¹³å‡è³ ç‡", 5.0) # 539å…©æ˜Ÿç´„53å€ï¼Œé€™è£¡ç”¨æœŸæœ›å€¼
    
    win_prob = st.slider("ğŸ“Š é ä¼°å‹ç‡ (Win Rate)", 0.0, 1.0, 0.20)
    
    # å‡±åˆ©å…¬å¼
    b = odds - 1
    p = win_prob
    q = 1 - p
    f = (b * p - q) / b if b > 0 else 0
    kelly_pct = max(f * 100, 0)
    
    # ç´…è“®æ¬Šé‡èª¿æ•´
    final_pct = kelly_pct * 0.8 # ä¿å®ˆä¿‚æ•¸
    if "34" in numbers: final_pct += 2.5 # æ ¸å¿ƒè™Ÿç¢¼åŠ æˆ
    final_pct = min(final_pct, 10.0) # é¢¨æ§ä¸Šé™
    
    st.markdown("### ğŸ›¡ï¸ æ±ºç­–å„€è¡¨æ¿")
    m1, m2, m3 = st.columns(3)
    m1.metric("å»ºè­°ä¸‹æ³¨æ¯”ä¾‹", f"{final_pct:.2f}%", "Kelly Criterion")
    m2.metric("å–®æ³¨é‡‘é¡", f"${budget * final_pct / 100:.0f}", "Risk Control")
    m3.metric("æ ¸å¿ƒä»£ç¢¼", "34", "Detected" if "34" in numbers else "None")
    
    if "34" in numbers:
        st.success("ğŸ”¥ **æ ¸å¿ƒä»£ç¢¼ 34 (ç«/å›å½ˆ)**ï¼šç³»çµ±åµæ¸¬åˆ°é«˜èƒ½é‡è™Ÿç¢¼ï¼Œå»ºè­°ä½œç‚ºè†½è™Ÿä½¿ç”¨ã€‚")

# ==============================================================================
# 2. ğŸ“ˆ Kç·šè¶¨å‹¢åˆ†æ (å›æ­¸ç‰ˆ)
# ==============================================================================
elif menu == "ğŸ“ˆ Kç·šè¶¨å‹¢åˆ†æ (å›æ­¸ç‰ˆ)":
    st.title("ğŸ“ˆ Kç·šè¶¨å‹¢åˆ†æãƒ»æ•¸å­—æˆ°æƒ…å®¤")
    st.markdown("è¼¸å…¥æ­·å²é–‹çæ•¸å­—ï¼Œåˆ†æå†·ç†±è¶¨å‹¢èˆ‡æ³¢æ®µã€‚")
    
    # æ•¸æ“šè¼¸å…¥å€
    input_data = st.text_area("è¼¸å…¥è¿‘æœŸæ•¸å­— (ä»¥é€—è™Ÿåˆ†éš”ï¼Œä¾‹å¦‚: 34, 25, 24, 11, 07, 34, 28, 05)", 
                              "34, 25, 24, 11, 07, 34, 28, 05, 12, 34, 25, 07, 07, 11, 24")
    
    if input_data:
        try:
            # æ•¸æ“šè™•ç†
            data_list = [int(x.strip()) for x in input_data.split(",")]
            df = pd.DataFrame(data_list, columns=["Number"])
            df['MA3'] = df['Number'].rolling(3).mean() # 3æœŸå‡ç·š
            df['MA5'] = df['Number'].rolling(5).mean() # 5æœŸå‡ç·š
            
            st.subheader("ğŸ“Š è¶¨å‹¢åœ–è¡¨")
            st.line_chart(df[['Number', 'MA3', 'MA5']])
            
            # çµ±è¨ˆåˆ†æ
            c1, c2, c3 = st.columns(3)
            c1.metric("æœ€è¿‘ä¸€æœŸ", data_list[-1])
            c2.metric("å¹³å‡å€¼", f"{np.mean(data_list):.1f}")
            c3.metric("å‡ºç¾æœ€å¤šæ¬¡", f"{df['Number'].mode()[0]}")
            
            st.markdown("### ğŸ“ ç´…è“®æŠ€è¡“é»è©•")
            last_num = data_list[-1]
            if last_num == 34:
                st.success("ğŸ”¥ **æŠ€è¡“é¢ç¢ºèª**ï¼š34 è™Ÿå‡ºç¾é »ç‡ä¸Šå‡ï¼Œç¬¦åˆå›å½ˆç‰¹å¾µ (Rebound)ã€‚")
            elif last_num < 10:
                st.info("ğŸ“‰ **å°æ•¸å€æ´»èº**ï¼šè¿‘æœŸèµ°å‹¢åå‘å€‹ä½æ•¸ï¼Œæ³¨æ„é‡å¿ƒè½‰ç§»ã€‚")
            else:
                st.warning("âš–ï¸ **éœ‡ç›ªæ•´ç†**ï¼šç›®å‰ç„¡æ˜é¡¯å–®é‚Šè¶¨å‹¢ï¼Œå»ºè­°è§€æœ› K ç·šäº¤å‰é»ã€‚")
                
        except Exception as e:
            st.error("æ•¸æ“šæ ¼å¼éŒ¯èª¤ï¼Œè«‹ç¢ºä¿åªè¼¸å…¥æ•¸å­—èˆ‡é€—è™Ÿã€‚")

# ==============================================================================
# 3. ğŸ‘§ äºˆå©•æƒ…ç·’é›·é” (æ——è‰¦ç‰ˆ - 1997/03/21 åˆæ™‚)
# ==============================================================================
elif menu == "ğŸ‘§ äºˆå©•æƒ…ç·’é›·é” (æ——è‰¦ç‰ˆ)":
    st.title("ğŸ‘§ äºˆå©•æƒ…ç·’é›·é”ãƒ»æ——è‰¦è§£æ")
    
    # é–å®šè³‡æ–™
    yj_birth = datetime.date(1997, 3, 21)
    today = datetime.date.today()
    gan, zhi = RedLotusCore.get_gan_zhi(today) # ä»Šæ—¥å¹²æ”¯
    
    st.markdown(f"""
    <div class="qimen-box">
    <b>Target:</b> Yu-Jie (äºˆå©•) <br>
    <b>Birthday:</b> 1997/03/21 (åˆæ™‚) <br>
    <b>ä»Šæ—¥æ™‚ç©º:</b> {today} ({gan}{zhi}æ—¥)
    </div>
    """, unsafe_allow_html=True)
    
    st.markdown("---")

    # 1. ç”Ÿç‰©ç¯€å¾‹ (ç²¾ç¢ºæ•¸å€¼)
    bio = RedLotusCore.get_biorhythm(yj_birth)
    
    col1, col2, col3 = st.columns(3)
    
    # æƒ…ç·’åˆ¤æ–·
    emo_score = bio['emo']
    if emo_score > 60: emo_state = "ğŸŒŸ æ¥µä½³ (Super High)"
    elif emo_score > 20: emo_state = "ğŸ˜Š æ„‰æ‚… (Happy)"
    elif emo_score > -20: emo_state = "ğŸ˜ å¹³æ·¡ (Neutral)"
    elif emo_score > -60: emo_state = "ğŸ˜Ÿ ç…©æ‚¶ (Low)"
    else: emo_state = "ğŸ’£ æš´èº (Danger)"
    
    col1.metric("â¤ï¸ æƒ…ç·’æŒ‡æ•¸ (Emotional)", f"{emo_score:.1f}", emo_state)
    col2.metric("âš¡ é«”åŠ›æŒ‡æ•¸ (Physical)", f"{bio['phy']:.1f}", "æ´»åŠ›å……æ²›" if bio['phy']>0 else "éœ€è¦ä¼‘æ¯")
    col3.metric("ğŸ§  æ™ºåŠ›æŒ‡æ•¸ (Intellectual)", f"{bio['intel']:.1f}", "é‚è¼¯æ¸…æ™°" if bio['intel']>0 else "ç›´è¦ºè¡Œäº‹")
    
    st.progress((emo_score + 100) / 200)

    # 2. å¥‡é–€é‹å‹¢ç–ŠåŠ  (äºˆå©•å°ˆå±¬)
    # 1997æ˜¯ä¸ä¸‘å¹´ (å±¬ç‰›)ï¼Œ3/21æ˜¯é›™é­š/ç‰¡ç¾Šäº¤ç•Œ
    st.subheader("ğŸ”® å¥‡é–€æ™‚ç©ºæƒæ")
    
    qimen = RedLotusCore.get_qimen_chart(today)
    st.write(f"**ä»Šæ—¥äºˆå©•å‘½å®®è½å…¥ï¼šã€{qimen['door']}ã€‘**")
    
    if "å‰" in qimen['door']:
        st.success(f"âœ… **é‹å‹¢å¤§å‰**ï¼šä»Šæ—¥è‡¨ **{qimen['door']}**ï¼Œä¸”æœ‰ **{qimen['star']}** ç…§è€€ã€‚å¥¹ä»Šå¤©å¿ƒæƒ…æ‡‰è©²ä¸éŒ¯ï¼Œå®¹æ˜“å¿ƒè»Ÿã€‚é©åˆæå‡ºè¦æ±‚ï¼")
        st.info("ğŸ’¡ **æ”»ç•¥å»ºè­°**ï¼šç›´æ¥å¸¶å¥¹å»åƒå¥½åƒçš„ï¼Œæˆ–è€…é€ä¸€å€‹å°ç¦®ç‰©ï¼Œæ•ˆæœåŠ å€ã€‚")
    else:
        st.error(f"âš ï¸ **é‹å‹¢å—é˜»**ï¼šä»Šæ—¥è‡¨ **{qimen['door']}**ï¼Œå¯èƒ½æœ‰ **{qimen['god']}** å¹²æ“¾ã€‚å¥¹å¯èƒ½å·¥ä½œä¸é †æˆ–æœ‰ç„¡åç«ã€‚")
        st.warning("ğŸ›¡ï¸ **ç”Ÿå­˜æ³•å‰‡**ï¼šä¿æŒè·é›¢ï¼Œä¸è¦ç¢ç¢å¿µã€‚å¦‚æœå¥¹ä¸èªªè©±ï¼Œä½ ä¹Ÿåˆ¥èªªè©±ã€‚")

# ==============================================================================
# 4. â¤ï¸ èˆŠæ„›è¤‡åˆæˆ°ç•¥éƒ¨ (å¥‡é–€éç”²ç‰ˆ)
# ==============================================================================
elif menu == "â¤ï¸ èˆŠæ„›è¤‡åˆ (å¥‡é–€éç”²ç‰ˆ)":
    st.title("â¤ï¸ èˆŠæ„›è¤‡åˆãƒ»å¥‡é–€éç”²ç›¤")
    st.markdown("é‹ç”¨ã€Œä¹™ã€åºšã€ä¸ã€ä¸™ã€èˆ‡ã€Œå…­åˆã€é€²è¡Œæ·±åº¦é—œä¿‚æ¨æ¼”ã€‚")
    
    c1, c2 = st.columns(2)
    your_name = c1.text_input("ä½ çš„ä»£è™Ÿ (æ—¥å¹²)", "åºš (ç”·æ–¹)")
    ex_name = c2.text_input("å°æ–¹ä»£è™Ÿ (æ™‚å¹²/ä¹™)", "ä¹™ (å¥³æ–¹)")
    
    breakup_days = st.slider("åˆ†æ‰‹å¤©æ•¸", 1, 365, 30)
    
    if st.button("ğŸ”® å¥‡é–€æ’ç›¤æ¨ç®—"):
        today = datetime.date.today()
        gan, zhi = RedLotusCore.get_gan_zhi(today)
        
        # æ¨¡æ“¬å¥‡é–€åˆ†æ
        score, texts = RedLotusCore.analyze_love_qimen(gan, "åºš") # å‡è¨­ä»Šå¹´æµå¹´å¹²
        
        st.divider()
        st.subheader(f"ğŸ“œ å¥‡é–€ç›¤å±€ï¼š{today} ({gan}{zhi}æ—¥)")
        
        k1, k2, k3 = st.columns(3)
        k1.metric("è¤‡åˆæ©Ÿç‡", f"{score}%", "å‹•æ…‹æ¨æ¼”")
        k2.metric("é—œéµç¥ç…", texts[-1].split("ï¼š")[1].split("ã€‚")[0]) # æå–ç¥ç…
        k3.metric("é—œä¿‚ç‹€æ…‹", "ç›¸ç”Ÿ" if score > 60 else "ç›¸å‰‹/æ¯”å’Œ")
        
        st.markdown("### ğŸ“ åˆ¤è®€çµæœ")
        for line in texts:
            st.write(line)
            
        st.markdown("### ğŸ›¡ï¸ ç´…è“®æˆ°è¡“æŒ‡ä»¤")
        if score > 70:
            st.success("ğŸ”¥ **é€²æ”»ä¿¡è™Ÿ**ï¼šå±€å‹¢å¤§å¥½ï¼ã€ä¹™åºšç›¸åˆã€æˆ–ã€å…­åˆã€å‡ºç¾ã€‚å»ºè­°ä¸»å‹•è¯ç¹«ï¼Œç´„è¦‹é¢ï¼ŒæˆåŠŸç‡æ¥µé«˜ã€‚")
        elif score > 40:
            st.warning("âš ï¸ **ç­‰å¾…æ™‚æ©Ÿ**ï¼šå±€å‹¢ä¸æ˜æœ—ã€‚å»ºè­°æ¡ç”¨ã€ä¼‘é–€ã€ç­–ç•¥ï¼ˆä¼‘æ¯ã€è§€å¯Ÿï¼‰ï¼Œå¶çˆ¾æŒ‰è®šäº’å‹•ï¼Œä¸è¦é€¼å¤ªç·Šã€‚")
        else:
            st.error("ğŸ›‘ **é˜²å®ˆä¿¡è™Ÿ**ï¼šç›®å‰ã€æ­»é–€ã€æˆ–ã€ç™½è™ã€ç•¶é“ã€‚å°æ–¹æ¥µåº¦æŠ—æ‹’ã€‚åˆ‡å‹¿è¯ç¹«ï¼Œå¦å‰‡æœƒè¢«å°é–ã€‚å…ˆæ–·è¯æå‡è‡ªå·±ã€‚")

# ==============================================================================
# 5. ğŸ‘¤ æœ¬å‘½è§£æ (å¥‡é–€éç”²ç‰ˆ)
# ==============================================================================
elif menu == "ğŸ‘¤ æœ¬å‘½è§£æ (å¥‡é–€éç”²ç‰ˆ)":
    st.title("ğŸ‘ï¸ æœ¬å‘½è§£æãƒ»å¤©ç¾…åœ°ç¶²")
    st.markdown("è¼¸å…¥ç”Ÿæ—¥ï¼Œåˆ©ç”¨å¥‡é–€è½å®®èˆ‡å…«å­—æ—¥ä¸»çœ‹ç©¿äººå¿ƒã€‚")
    
    col1, col2 = st.columns(2)
    b_date = col1.date_input("å‡ºç”Ÿå¹´æœˆæ—¥", datetime.date(1996, 2, 17))
    b_time = col2.time_input("å‡ºç”Ÿæ™‚é–“ (å¯é¸)", datetime.time(12, 0))
    
    if st.button("ğŸ”¥ å•Ÿå‹•å…¨æ¯è§£æ"):
        # è¨ˆç®—æ—¥ä¸»
        gan, zhi = RedLotusCore.get_gan_zhi(b_date)
        
        st.divider()
        st.markdown(f"### ğŸ¯ å‘½ç›¤æ ¸å¿ƒï¼šã€{gan}{zhi}ã€‘æ—¥æŸ±")
        
        # æ€§æ ¼è³‡æ–™åº«
        traits = {
            "ç”²": "é ˜è¢–å‹ (é–‹é–€)ã€‚æ­£ç›´ã€åš´è‚…ï¼Œä¸å–œæ­¡å½å½ç¹ç¹ã€‚",
            "ä¹™": "è»å¸«å‹ (ä¼‘é–€)ã€‚éˆæ´»ã€é©æ‡‰åŠ›å¼·ï¼Œå–„æ–¼è¿‚è¿´æˆ°è¡“ã€‚",
            "ä¸™": "æˆ°å°‡å‹ (æ™¯é–€)ã€‚ç†±æƒ…ã€æš´èºï¼Œè¡Œå‹•åŠ›ç¬¬ä¸€ï¼Œè—ä¸ä½è©±ã€‚",
            "ä¸": "è¬€ç•¥å‹ (æœé–€)ã€‚å¿ƒæ€æ·±æ²ˆç´°è†©ï¼Œç¬¬å…­æ„Ÿå¼· (å¦‚ä½ )ã€‚",
            "æˆŠ": "å®°ç›¸å‹ (ç”Ÿé–€)ã€‚ç©©é‡æ•¦åšï¼Œå®ˆè²¡å¥´ï¼Œå€¼å¾—ä¿¡è³´ã€‚",
            "å·±": "ç­–åŠƒå‹ (æ­»é–€)ã€‚å…§æ–‚å¤šç–‘ï¼Œä½†åšäº‹æ»´æ°´ä¸æ¼ã€‚",
            "åºš": "é–‹æ‹“å‹ (é©šé–€)ã€‚å‰›æ¯…æœæ–·ï¼Œå¥½é¬¥ï¼Œåƒè»Ÿä¸åƒç¡¬ã€‚",
            "è¾›": "å®Œç¾å‹ (é©šé–€)ã€‚æ„›é¢å­ï¼Œé‡è¦–ç´°ç¯€ï¼Œèªªè©±å¸¶åˆºã€‚",
            "å£¬": "éŠä¿ å‹ (å‚·é–€)ã€‚è°æ˜å¥”æ”¾ï¼Œä¸å—æ‹˜æŸï¼Œæ˜“æƒ…ç·’åŒ–ã€‚",
            "ç™¸": "æ½›ä¼å‹ (ä¼‘é–€)ã€‚æº«æŸ”ä¼¼æ°´ä½†æ·±ä¸å¯æ¸¬ï¼Œè€åŠ›æ¥µå¼·ã€‚"
        }
        
        trait = traits.get(gan, "ç¥ç§˜å‹")
        
        # é¡¯ç¤º
        c1, c2 = st.columns(2)
        c1.info(f"**ã€æ—¥ä¸»æ€§æ ¼ã€‘ï¼š{gan}ç«/æœ¨/é‡‘/æ°´/åœŸ**\n\n{trait}")
        
        # å¥‡é–€æ¨¡æ“¬è½å®®
        qimen_life = RedLotusCore.get_qimen_chart(b_date)
        c2.success(f"**ã€æœ¬å‘½å¥‡é–€ã€‘ï¼šè‡¨ {qimen_life['door']}**\n\nå®ˆè­·æ˜Ÿï¼š{qimen_life['star']}\nå®ˆè­·ç¥ï¼š{qimen_life['god']}")
        
        st.markdown("### ğŸ›¡ï¸ ç´…è“®ç”¨äººå»ºè­°")
        st.write(f"æ­¤äººæ—¥å¹²ç‚º **{gan}**ï¼Œè‡¨ **{qimen_life['door']}**ã€‚")
        if "å‰" in qimen_life['door']:
            st.write("ğŸ‘‰ **æ ¼å±€å¤§æ°£**ï¼Œé‹å‹¢é †é‚ï¼Œé©åˆæ“”ä»»æ ¸å¿ƒæ±ºç­–è€…æˆ–åˆä½œå¤¥ä¼´ã€‚")
        else:
            st.write("ğŸ‘‰ **æ ¼å±€éšªå³»**ï¼Œæ€§æ ¼å¯èƒ½è¼ƒåæ¿€æˆ–å›ºåŸ·ï¼Œé©åˆåŸ·è¡Œå–®å…µä»»å‹™ï¼Œéœ€çµ¦äºˆæ˜ç¢ºæŒ‡ä»¤ã€‚")

# ==============================================================================
# 6. ğŸ¢ éˆé¾œå¤§å‰ (æœ¬æœŸæ ¸å¿ƒ)
# ==============================================================================
elif menu == "ğŸ¢ éˆé¾œå¤§å‰ (æœ¬æœŸæ ¸å¿ƒ)":
    st.title("ğŸ¢ éˆé¾œå¤§å‰ãƒ»å”¯ä¸€èªè­‰")
    st.balloons()
    
    st.markdown("""
    <div style="text-align: center; font-size: 48px; font-weight: bold; color: #d63031; background-color: #ffeaa7; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
    07ã€11ã€24ã€25ã€34
    </div>
    """, unsafe_allow_html=True)
    
    c1, c2 = st.columns(2)
    with c1:
        st.error("ğŸ”¥ **æ ¸å¿ƒä¸»æ˜Ÿï¼š34**")
        st.write("å±¬æ€§ï¼šç´…è‰² / é›™æ•¸ / ä¸™ç«ã€‚\næ„ç¾©ï¼šå›å½ˆè‡¨ç•Œé»ï¼Œå‹¢ä¸å¯æ“‹ã€‚")
    with c2:
        st.info("ğŸ›¡ï¸ **è­·æ³•é™£å‹ï¼š07, 11, 24, 25**")
        st.write("æ„ç¾©ï¼š07èˆ‡34å‘¼æ‡‰ (3+4=7)ï¼Œ24/25 å»ºæ§‹é€£è™Ÿé˜²ç·šã€‚")

# ==============================================================================
# 7. â³ ä»Šæ—¥æ™‚ç©º (æµæ—¥)
# ==============================================================================
elif menu == "â³ ä»Šæ—¥æ™‚ç©º (æµæ—¥)":
    today = datetime.date.today()
    gan, zhi = RedLotusCore.get_gan_zhi(today)
    
    st.title(f"â³ ä»Šæ—¥æ™‚ç©ºæˆ°ç•¥ï¼š{today}")
    st.subheader(f"ä»Šæ—¥å¹²æ”¯ï¼šã€{gan}{zhi}ã€‘æ—¥")
    
    col1, col2 = st.columns(2)
    with col1:
        st.markdown("#### ğŸŒ èƒ½é‡åˆ†æ")
        if gan in ["ä¸™", "ä¸", "å·³", "åˆ"]:
            st.write("ğŸ”¥ **äº”è¡Œï¼šç«æ—º**ã€‚åˆ©æ–¼æ•¸å­— 3, 4 (ç´…æ³¢)ã€‚")
        elif gan in ["åºš", "è¾›", "ç”³", "é…‰"]:
            st.write("âš”ï¸ **äº”è¡Œï¼šé‡‘æ—º**ã€‚åˆ©æ–¼æ•¸å­— 4, 9ã€‚")
        elif gan in ["å£¬", "ç™¸", "äº¥", "å­"]:
            st.write("ğŸ’§ **äº”è¡Œï¼šæ°´æ—º**ã€‚åˆ©æ–¼æ•¸å­— 1, 6 (è—æ³¢)ã€‚")
        elif gan in ["ç”²", "ä¹™", "å¯…", "å¯"]:
            st.write("ğŸŒ² **äº”è¡Œï¼šæœ¨æ—º**ã€‚åˆ©æ–¼æ•¸å­— 3, 8 (ç¶ æ³¢)ã€‚")
        else:
            st.write("â›°ï¸ **äº”è¡Œï¼šåœŸæ—º**ã€‚åˆ©æ–¼æ•¸å­— 0, 5ã€‚")
            
    with col2:
        st.markdown("#### ğŸ•°ï¸ å¥‡é–€å‰æ™‚")
        st.write("1. **åˆæ™‚ (11-13)**ï¼šé’é¾è¿”é¦–ï¼Œå¤§å‰ã€‚")
        st.write("2. **æˆŒæ™‚ (19-21)**ï¼šå¤©ä¹™è²´äººï¼Œåˆ©æ±‚è²¡ã€‚")

st.markdown("---")
st.caption("Powered by Red Lotus System V5.0 | Ultimate Edition")
